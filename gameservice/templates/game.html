{% extends 'base.html' %}

{% block content %}

	{% for s in scores %}
	<p> Score: {{s.score}} by: {{s.player.username}}</p>
	{% endfor %}

<iframe id="freimi" src="{{game.url}}" height=800 width=90% name="iframe1"></iframe>
<br><br>

<div id="tekstit"><div>

<script>


	window.addEventListener("message", function(evt) {

				// If LOAD, update the score
				if(evt.data.messageType === "SCORE") {
					var score = evt.data.score;

					$.ajax({
						url: "{% url 'submit_highscore' game.id %}",
						type: 'POST',
						data: {
							score: score,
							csrfmiddlewaretoken: '{{ csrf_token }}'
						},
						success: function(data) {
							console.log("score submitted: " + score);
						}

					});

				}

	      else if (evt.data.messageType === "SAVE") {
					gs = evt.data.gameState;
	        changemessage("saved game with score: " + evt.data.gameState.score);
	      }

	      else if (evt.data.messageType === "LOAD_REQUEST") {


	      }

	      else if (evt.data.messageType === "SETTING") {
	        adjustIframe(evt.data.options.width, evt.data.options.height);
	        changemessage("settings requested: " + evt.data.options.height + "x" + evt.data.options.width);
	      }

			});

	function changeMessage(msg) {
		document.getElementById("asd").innerHTML = msg;

	}
	function adjustIframe(x, y) {
	  document.getElementById("freimi").width = x;
	  document.getElementById("freimi").height = y;
	}




	// 	changemessage("Responded with load game with score of: " + gs.score );
	// 	var iframe = document.getElementById("freimi")
	// 	var x = iframe.contentWindow;
	// 	x.postMessage(msg, '*');
	// }

	function changetarget() {
		var tekstikentta = document.getElementById("joku");
		var newpath = tekstikentta.value;
		var iframe = document.getElementById("freimi");
		iframe.src = newpath;
	}

	function changemessage(msg) {
		var elem = document.getElementById("tekstit");
		elem.innerHTML += msg +"<br>";
	}
</script>

{% endblock %}
